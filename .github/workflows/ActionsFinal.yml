name: Actions TestNG

on:
  push:
  schedule:
    - cron: '30 6 * * *'   # Runs at 12:00 PM IST daily
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Build and Run Tests with Maven
        run: mvn clean test

  notify:
    needs: test
    runs-on: ubuntu-latest
    if: always()   # Send email whether test passed or failed

    steps:
      - name: Send Notification Email
        uses: dawidd6/action-send-mail@v4
        with:
          server_address: smtp.gmail.com
          server_port: 587
          secure: false
          username: ${{ secrets.SMTP_USERNAME }}     # e.g., your Gmail address
          password: ${{ secrets.SMTP_PASSWORD }}     # App password
          subject: GitHub Actions Test Report - ${{ needs.test.result }}
          to: avkkumar1998@gmail.com             # replace with your actual email
          from: GitHub Actions <${{ secrets.SMTP_USERNAME }}>
          body: |
            Hello Team,

            The Sanity testing has been completed.

            ğŸ“„ **Status:** ${{ needs.test.result }}
            
            ğŸ” **Commit:** ${{ github.sha }}
            
            ğŸ•’ **Time:** ${{ github.event.head_commit.timestamp }}

            Regards,  
            QA Team
